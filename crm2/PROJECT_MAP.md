# üìÇ PROJECT_MAP.md ‚Äî –∫–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ CRM2

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤

```
crm2/
‚îú‚îÄ‚îÄ __main__.py           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –∑–∞–ø—É—Å–∫–∞–µ—Ç main() –∏–∑ app.py
‚îú‚îÄ‚îÄ app.py                # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ auto_migrate.py       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –∏–Ω–¥–µ–∫—Å–æ–≤)
‚îú‚îÄ‚îÄ db/                   # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ users.py          # CRUD –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ sessions.py       # CRUD –¥–ª—è —Å–µ—Å—Å–∏–π –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ attendance.py     # –£—á—ë—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ profile.py        # –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ handlers/             # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –∫–Ω–æ–ø–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ start.py          # /start, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≤—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ auth.py           # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ info.py           # –†–∞–∑–¥–µ–ª ¬´–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è¬ª
‚îÇ   ‚îú‚îÄ‚îÄ admin_users.py    # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ admin_schedule.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ admin_attendance.py # –£—á—ë—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (–∞–¥–º–∏–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ admin_db_doctor.py # –ü—Ä–æ–≤–µ—Ä–∫–∞/–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î (¬´DB Doctor¬ª)
‚îú‚îÄ‚îÄ keyboards/            # Inline/Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py      # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ schedule.py       # –ö–Ω–æ–ø–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ profile.py        # –ö–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ agents.py         # –ö–Ω–æ–ø–∫–∏ –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ admin_*           # –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –º–µ–Ω—é
‚îî‚îÄ‚îÄ utils/                # –£—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```

---

## üóÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (crm.db)

### users
- id ‚Äî PK
- telegram_id ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID TG
- username, nickname, full_name
- password ‚Äî —Ö—ç—à
- role ‚Äî —Ä–æ–ª—å (admin/user)
- phone, email
- events, participants
- cohort_id ‚Äî —Å–≤—è–∑–∫–∞ —Å cohorts

### cohorts
- id, name

### participants
- id
- user_id ‚Äî FK users.id
- cohort_id ‚Äî FK cohorts.id
- stream_id ‚Äî FK streams.id
- created_at

### streams
- id, title

### sessions
- id, start_date, end_date
- topic_code, title, annotation
- stream_id, cohort_id

### session_days
- id, date, stream_id, topic_id, topic_code

### topics
- id, code, title, annotation

### materials
- id, title, body, tg_file_id, mime, created_by, created_at

### assignments
- id, title, body, material_id, due_date, created_by, created_at

### broadcasts
- id, title, body, attachment, audience, cohort_id, status, etc.

### broadcast_recipients
- broadcast_id, user_id, status, sent_at

### consents
- telegram_id, given, ts

---

## üîß –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ —Ñ–∞–π–ª–∞–º

### db/users.py
- `get_user_by_tg()` ‚Äî –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id
- `add_user()` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ
- `update_user_role()` ‚Äî —Å–º–µ–Ω–∞ —Ä–æ–ª–∏
- `list_users()` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### db/sessions.py
- `get_upcoming_sessions_by_cohort()` ‚Äî –±–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è –¥–ª—è –ø–æ—Ç–æ–∫–∞
- `get_all_sessions()` ‚Äî –æ–±—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `add_session()` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ

### db/attendance.py
- `mark_attendance()` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏–µ
- `get_attendance_by_user()` ‚Äî –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
- `get_attendance_by_cohort()` ‚Äî –∂—É—Ä–Ω–∞–ª –¥–ª—è –ø–æ—Ç–æ–∫–∞

### handlers/start.py
- `cmd_start()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ /start
- –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö / –ø–µ—Ä–µ—Ö–æ–¥ –≤ –º–µ–Ω—é —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### handlers/admin_db_doctor.py
- `show_menu()` ‚Äî –º–µ–Ω—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î
- `show_structure()` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã/—Å—Ö–µ–º—É
- `fix_sessions()` ‚Äî –ø–æ—á–∏–Ω–∏—Ç—å —Å–µ—Å—Å–∏–∏ (–¥–æ–±–∞–≤–∏—Ç—å cohort_id)
- `show_indexes()` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã

---
## –ü—Ä–∞–≤–∏–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –∏ –ø—É—Ç–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª:

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**  
   - –°–Ω–∞—á–∞–ª–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

2. **–°–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤**  
   - AI —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–∏—Å–ª–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `app.py`, `handlers/attendance.py`, `db/users.py`).

3. **–ü–µ—Ä–µ–¥–∞—á–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤**  
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ —Ñ–∞–π–ª—ã –∏–∑ –∞—Ä—Ö–∏–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞.

4. **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞**  
   - AI –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤, –±–µ–∑ –¥–æ–≥–∞–¥–æ–∫.

5. **–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö**  
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –±–∞–∑—É (`/var/data/crm.db`), AI –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü (`.schema`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `PROJECT_MAP.md`.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –≤—Ä–µ–º–µ–Ω–∏ –∏–∑-–∑–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π.
"""

[!] –£ –ò–≥–æ—Ä—è –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–ø–∞—Ä–≥–∞–ª–∫–∏. –≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî –∫–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞.

## ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–ª—É–∂–∏—Ç ¬´–∫–∞—Ä—Ç–æ–π¬ª –ø—Ä–æ–µ–∫—Ç–∞.  
–ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å–≤–µ—Ä—è–µ–º—Å—è —Å –Ω–∏–º, —á—Ç–æ–±—ã –Ω–µ –≤–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä: `stream` ‚Üí `cohort_id`).

